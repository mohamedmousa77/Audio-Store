<div class="admin-layout">
  <app-admin-sidebar />

  <div class="main-content">
    <app-admin-header />

    <div class="content-area">

      <div class="controls-card">
        <div class="controls-row">
          <div class="search-box">
            <span class="material-icons">search</span>
            <input type="text" placeholder="Search by name or SKU..." [ngModel]="searchTerm()"
              (ngModelChange)="searchTerm.set($event)" class="search-input" />
          </div>

          <div class="filter-controls">
            <select [ngModel]="selectedCategory()" (ngModelChange)="selectedCategory.set($event ? +$event : null)"
              class="filter-select">
              <option [value]="null">All Categories</option>
              @for (cat of categories(); track cat.id) {
              <option [value]="cat.id">{{ cat.name }}</option>
              }
            </select>

            <select [ngModel]="selectedStatus()" (ngModelChange)="selectedStatus.set($event)" class="filter-select">
              <option value="">All Status</option>
              <option value="Available">Available</option>
              <option value="Low Stock">Low Stock</option>
              <option value="Unavailable">Unavailable</option>
            </select>

            @if (searchTerm() || selectedCategory() || selectedStatus()) {
            <button class="btn btn-secondary" (click)="clearFilters()">
              <span class="material-icons">clear</span>
              Clear
            </button>
            }
          </div>
        </div>

        <div class="results-info">
          <p>Showing <strong>{{ filteredProducts().length }}</strong> of <strong>{{ products().length }}</strong>
            products</p>
          <button class="btn btn-primary" (click)="openAddProduct()">
            <span class="material-icons">add</span>
            Add New Product
          </button>
        </div>
      </div>

      <div class="products-table-card">
        <div class="table-container">
          <table class="products-table">
            <thead>
              <tr>
                <th>PRODUCT</th>
                <th>CATEGORY</th>
                <th>PRICE</th>
                <th>STOCK</th>
                <th>STATUS</th>
                <th>FLAGS</th>
                <th>ACTIONS</th>
              </tr>
            </thead>
            <tbody>
              @for (product of filteredProducts(); track product.id) {
              <tr class="product-row" (click)="editProduct(product)"
                [class.active-row]="editingProduct()?.id === product.id">
                <td>
                  <div class="product-info-cell">
                    <img [src]="product.mainImage" [alt]="product.name" class="product-thumb" />
                    <div class="product-texts">
                      <p class="product-name">{{ product.name }}</p>
                      <p class="product-sku">{{ product.brand }} â€¢ SKU: {{ product.sku }}</p>
                    </div>
                  </div>
                </td>
                <td>
                  <span class="category-tag">{{ getCategoryName(product.categoryId) }}</span>
                </td>
                <td>
                  <span class="product-price">{{ formatPrice(product.price) }}</span>
                </td>
                <td>
                  <span class="stock-count" [ngClass]="{
                      'stock-low': product.stockQuantity < 10 && product.stockQuantity > 0,
                      'stock-out': product.stockQuantity === 0
                    }">
                    {{ product.stockQuantity }}
                  </span>
                </td>
                <td>
                  <app-badge [status]="product.status" />
                </td>
                <td>
                  <div class="flags-container">
                    @if (product.isFeatured) {
                    <span class="flag-pill featured">FEAT</span>
                    }
                    @if (product.isNew) {
                    <span class="flag-pill new">NEW</span>
                    }
                  </div>
                </td>
                <td>
                  <div class="action-buttons">
                    <span class="material-icons edit"
                      (click)="editProduct(product); $event.stopPropagation()">edit</span>
                    <span class="material-icons delete"
                      (click)="deleteProduct(product); $event.stopPropagation()">delete</span>
                  </div>
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
      </div>

      <div id="product-form-section">
        @if (isFormOpen()) {
        <app-product-form [productData]="editingProduct()" [categories]="categories()" (cancel)="closeForm()">
        </app-product-form>
        }
      </div>
    </div>
  </div>
</div>