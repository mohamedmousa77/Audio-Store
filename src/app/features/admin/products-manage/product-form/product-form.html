<div class="product-edit-container">
  <div class="form-page-header">
    <div class="header-left">
      <h2 class="form-title">{{ productData.id ? 'Edit Product' : 'Create Product' }}</h2>
      <p class="form-subtitle">Add a new item to your catalog. Fill in the details below.</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="onCancel()">Cancel</button>
      <button class="btn btn-primary" (click)="onSave()">Save Product</button>
    </div>
  </div>

  <div class="form-grid-layout">
    <div class="form-column-main">
      <div class="form-column-main">
        <div class="form-card">
          <h3>General Information</h3>
          <div class="form-group">
            <label>Product Name *</label>
            <input type="text" name="productName" [(ngModel)]="productData!.name" placeholder="e.g. Sony WH-1000XM5"
              [class.input-error]="validationErrors['name']">
            @if (validationErrors['name']) {
            <span class="field-error">{{ validationErrors['name'] }}</span>
            }
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Brand</label>
              <input type="text" name="productBrand" [(ngModel)]="productData!.brand" placeholder="e.g. Sony">
            </div>
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea rows="6" name="productDescription" [(ngModel)]="productData!.description"
              placeholder="Describe the product features..."></textarea>
          </div>
        </div>

        <div class="form-card">
          <h3>Technical Specifications</h3>
          <div class="form-group">
            <label>Specifications</label>
            <textarea rows="4" name="productSpecifications" [(ngModel)]="productData!.specifications"
              placeholder="Battery Life: 30 hours..."></textarea>
          </div>
        </div>

        <div class="form-card">
          <h3>Pricing & Inventory</h3>
          <div class="form-row">
            <div class="form-group">
              <label>Price *</label>
              <input type="number" name="productPrice" [(ngModel)]="productData!.price" placeholder="$ 0.00"
                [class.input-error]="validationErrors['price']">
              @if (validationErrors['price']) {
              <span class="field-error">{{ validationErrors['price'] }}</span>
              }
            </div>
            <div class="form-group">
              <label>Stock Quantity *</label>
              <input type="number" name="productStock" [(ngModel)]="productData!.stockQuantity">
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="form-column-side">
      <div class="form-card">
        <h3>Organization</h3>
        <div class="form-group">
          <label>Category *</label>
          <select name="productCategory" [(ngModel)]="productData!.categoryId"
            [class.input-error]="validationErrors['categoryId']">
            <option [ngValue]="null">Select category</option>
            <option *ngFor="let cat of categories" [ngValue]="cat.id">{{ cat.name }}</option>
          </select>
          @if (validationErrors['categoryId']) {
          <span class="field-error">{{ validationErrors['categoryId'] }}</span>
          }
        </div>
      </div>

      <div class="form-card">
        <h3>Product Media</h3>
        <label>Main Image</label>
        <input type="file" #mainImageInput accept="image/*" (change)="onMainImageSelected($event)" hidden>

        @if (productData?.mainImage) {
        <!-- Preview replaces upload area, clickable to change -->
        <div class="image-preview clickable" (click)="mainImageInput.click()">
          <img [src]="productData!.mainImage" alt="Main image preview">
          <div class="image-overlay">
            <span class="material-icons">edit</span>
            <p>Click to change</p>
          </div>
        </div>
        } @else {
        <!-- Upload area shown only when no image -->
        <div class="upload-area" (click)="mainImageInput.click()">
          <span class="material-icons">cloud_upload</span>
          <p>Click to upload main image</p>
        </div>
        }

        <label class="mt-1">Gallery Images</label>
        <input type="file" #galleryImageInput accept="image/*" (change)="onGalleryImageSelected($event)" hidden>
        <div class="upload-area upload-area-small" (click)="galleryImageInput.click()">
          <span class="material-icons">add_photo_alternate</span>
          <p>Add gallery image</p>
        </div>
        <div class="gallery-preview" *ngIf="productData?.galleryImages?.length">
          <div class="gallery-item" *ngFor="let img of productData!.galleryImages; let i = index">
            <img [src]="img" alt="Gallery image">
            <button class="remove-btn" (click)="removeGalleryImage(i)">&times;</button>
          </div>
        </div>
      </div>

      <div class="form-card">
        <h3>Visibility</h3>
        <div class="toggle-group">
          <div class="toggle-item">
            <div class="toggle-text">
              <p class="toggle-label">Available</p>
              <p class="toggle-desc">Product can be purchased</p>
            </div>
            <label class="switch"><input type="checkbox" name="productAvailable"
                [(ngModel)]="productData!.isAvailable"><span class="slider round"></span></label>
          </div>
          <div class="toggle-item">
            <div class="toggle-text">
              <p class="toggle-label">New Arrival</p>
              <p class="toggle-desc">Mark as 'New'</p>
            </div>
            <label class="switch"><input type="checkbox" name="productIsNew" [(ngModel)]="productData!.isNew"><span
                class="slider round"></span></label>
          </div>
          <div class="toggle-item">
            <div class="toggle-text">
              <p class="toggle-label">Featured</p>
              <p class="toggle-desc">Show on homepage</p>
            </div>
            <label class="switch"><input type="checkbox" name="productFeatured"
                [(ngModel)]="productData!.isFeatured"><span class="slider round"></span></label>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>