<div class="product-edit-container">
  <div class="form-page-header">
    <div class="header-left">
      <h2 class="form-title">{{ productData.id ? translations().productsManagement.productForm.editeTitle : translations().productsManagement.productForm.addTitle }}</h2>
      @if(!productData.id){ 
      <p class="form-subtitle">{{ translations().productsManagement.productForm.addSubtitle }}</p>
      }
      
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="onCancel()">{{ translations().productsManagement.productForm.cancelButton }}</button>
      <button class="btn btn-primary" (click)="onSave()">{{ translations().productsManagement.productForm.saveButton }}</button>
    </div>
  </div>

  <div class="form-grid-layout">
    <div class="form-column-main">
      <div class="form-column-main">
        <div class="form-card">
          <h3>{{translations().productsManagement.productForm.generalInfo.title}}</h3>
          <div class="form-group">
            <label>{{translations().productsManagement.productForm.generalInfo.productName}}</label>
            <input type="text" name="productName" [(ngModel)]="productData!.name" placeholder="e.g. Sony WH-1000XM5"
              [class.input-error]="validationErrors['name']">
            @if (validationErrors['name']) {
            <span class="field-error">{{ validationErrors['name'] }}</span>
            }
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>{{translations().productsManagement.productForm.generalInfo.brand}}</label>
              <input type="text" name="productBrand" [(ngModel)]="productData!.brand" placeholder="e.g. Sony">
            </div>
          </div>
          <div class="form-group">
            <label>{{translations().productsManagement.productForm.generalInfo.description}}</label>
            <textarea rows="6" name="productDescription" [(ngModel)]="productData!.description"
              placeholder={{translations().productsManagement.productForm.generalInfo.descriptionPlaceholder}}></textarea>
          </div>
        </div>

        <div class="form-card">
          <h3>{{translations().productsManagement.productForm.generalInfo.specifications}}</h3>
          <div class="form-group">
            <label>{{translations().productsManagement.productForm.generalInfo.specificationsTitle}}</label>
            <textarea rows="4" name="productSpecifications" [(ngModel)]="productData!.specifications"
              placeholder={{translations().productsManagement.productForm.generalInfo.specificationsPlaceholder}}></textarea>
          </div>
        </div>

        <div class="form-card">
          <h3>{{translations().productsManagement.productForm.generalInfo.priceAndInventory.title}}</h3>
          <div class="form-row">
            <div class="form-group">
              <label>{{translations().productsManagement.productForm.generalInfo.priceAndInventory.price}}</label>
              <input type="number" name="productPrice" [(ngModel)]="productData!.price" placeholder="$ 0.00"
                [class.input-error]="validationErrors['price']">
              @if (validationErrors['price']) {
              <span class="field-error">{{ validationErrors['price'] }}</span>
              }
            </div>
            <div class="form-group">
              <label>{{translations().productsManagement.productForm.generalInfo.priceAndInventory.stockQuantity}}</label>
              <input type="number" name="productStock" [(ngModel)]="productData!.stockQuantity">
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="form-column-side">
      <div class="form-card">
        <h3>{{translations().productsManagement.productForm.generalInfo.organization.title}}</h3>
        <div class="form-group">
          <label>{{translations().productsManagement.productForm.generalInfo.organization.category}}</label>
          <select name="productCategory" [(ngModel)]="productData!.categoryId"
            [class.input-error]="validationErrors['categoryId']">
            <option [ngValue]="null">{{translations().productsManagement.productForm.generalInfo.organization.selectCategory}}</option>
            @for(cat of categories; track cat.id){
              <option [ngValue]="cat.id">{{ cat.name }}</option>
            }
            
          </select>
          @if (validationErrors['categoryId']) {
          <span class="field-error">{{ validationErrors['categoryId'] }}</span>
          }
        </div>
      </div>

      <div class="form-card">
        <h3>{{translations().productsManagement.productForm.generalInfo.organization.productMedia}}</h3>
        <label>{{translations().productsManagement.productForm.generalInfo.organization.MainImage}}</label>
        <input type="file" #mainImageInput accept="image/*" (change)="onMainImageSelected($event)" hidden>

        @if (productData?.mainImage) {
        <!-- Preview replaces upload area, clickable to change -->
        <div class="image-preview clickable" (click)="mainImageInput.click()">
          <img [src]="productData!.mainImage" alt="Main image preview">
          <div class="image-overlay">
            <span class="material-icons">edit</span>
            <p>{{translations().productsManagement.productForm.generalInfo.organization.editeImage}}</p>
          </div>
        </div>
        } @else {
        <!-- Upload area shown only when no image -->
        <div class="upload-area" (click)="mainImageInput.click()">
          <span class="material-icons">cloud_upload</span>
          <p>{{translations().productsManagement.productForm.generalInfo.organization.addImageButton}}</p>
        </div>
        }

        <label class="mt-1">{{translations().productsManagement.productForm.generalInfo.organization.galleryImages}}</label>
        <input type="file" #galleryImageInput accept="image/*" (change)="onGalleryImageSelected($event)" hidden>
        <div class="upload-area upload-area-small" (click)="galleryImageInput.click()">
          <span class="material-icons">add_photo_alternate</span>
          <p>{{translations().productsManagement.productForm.generalInfo.organization.addGalleryImage}}</p>
        </div>
        @if(productData?.galleryImages?.length){
          <div class="gallery-preview">
            <!-- @for(img of productData!.galleryImages; i = index){} -->
          <div class="gallery-item" *ngFor="let img of productData!.galleryImages; let i = index">
            <img [src]="img" alt="Gallery image">
            <button class="remove-btn" (click)="removeGalleryImage(i)">&times;</button>
          </div>
        </div>
        }
        
      </div>

      <div class="form-card">
        <h3>{{translations().productsManagement.productForm.generalInfo.visibility.title}}</h3>
        <div class="toggle-group">
          <div class="toggle-item">
            <div class="toggle-text">
              <p class="toggle-label">{{translations().productsManagement.productForm.generalInfo.visibility.available}}</p>
              <p class="toggle-desc">{{translations().productsManagement.productForm.generalInfo.visibility.availableSubtitle}}</p>
            </div>
            <label class="switch"><input type="checkbox" name="productAvailable"
                [(ngModel)]="productData!.isAvailable"><span class="slider round"></span></label>
          </div>
          <div class="toggle-item">
            <div class="toggle-text">
              <p class="toggle-label">{{translations().productsManagement.productForm.generalInfo.visibility.newArrival}}</p>
              <p class="toggle-desc">{{translations().productsManagement.productForm.generalInfo.visibility.newArrivalSubtitle}}</p>
            </div>
            <label class="switch"><input type="checkbox" name="productIsNew" [(ngModel)]="productData!.isNew"><span
                class="slider round"></span></label>
          </div>
          <div class="toggle-item">
            <div class="toggle-text">
              <p class="toggle-label">{{translations().productsManagement.productForm.generalInfo.visibility.featured}}</p>
              <p class="toggle-desc">{{translations().productsManagement.productForm.generalInfo.visibility.featuredSubtitle}}</p>
            </div>
            <label class="switch"><input type="checkbox" name="productFeatured"
                [(ngModel)]="productData!.isFeatured"><span class="slider round"></span></label>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>