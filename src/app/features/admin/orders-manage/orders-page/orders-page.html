<div class="admin-layout">
  <app-admin-sidebar />

  <div class="main-content">
    <app-admin-header />

    <div class="content-area">
      <div class="controls-card">
        <div class="controls-row">
          <div class="search-box">
            <span class="material-icons">search</span>
            <input type="text" placeholder="Search by Order ID or Customer..." [ngModel]="searchTerm()"
              (ngModelChange)="searchTerm.set($event)" class="search-input" />
          </div>

          <div class="filter-controls">
            <select [ngModel]="selectedStatus()" (ngModelChange)="selectedStatus.set($event)" class="filter-select">
              <option value="">All Status</option>
              <option [value]="OrderStatus.Pending">Pending</option>
              <option [value]="OrderStatus.Processing">Processing</option>
              <option [value]="OrderStatus.Shipped">Shipped</option>
              <option [value]="OrderStatus.Delivered">Delivered</option>
              <option [value]="OrderStatus.Cancelled">Cancelled</option>
            </select>
            @if (searchTerm() || selectedStatus() !== '') {
            <button class="btn btn-secondary" (click)="clearFilters()">
              <span class="material-icons">clear</span> Clear
            </button>
            }
          </div>
        </div>

        <div class="results-info">
          <div class="summary-chips">
            <span class="summary-chip">Total Orders: <strong>{{ getTotalOrders() }}</strong></span>
            <span class="summary-chip">In Transit: <strong>{{ getShippedCount() }}</strong></span>
          </div>
          <p class="results-count">Showing <strong>{{ filteredOrders().length }}</strong> orders</p>
        </div>
      </div>

      <div class="orders-table-card">
        <div class="table-container">
          <table class="model-table">
            <thead>
              <tr>
                <th>ORDER ID</th>
                <th>DATE</th>
                <th>CUSTOMER</th>
                <th>TOTAL</th>
                <th>STATUS</th>
                <th>ACTIONS</th>
              </tr>
            </thead>
            <tbody>
              @for (order of filteredOrders(); track order.id) {
              <tr class="order-row" (click)="selectOrder(order)" [class.active-row]="selectedOrder()?.id === order.id">
                <td><span class="order-id-label">{{ order.orderNumber }}</span></td>
                <td><span class="text-secondary">{{ formatDate(order.orderDate) }}</span></td>
                <td>
                  <div class="customer-cell">
                    <div class="avatar-small">{{ getCustomerInitial(order) }}</div>
                    <div class="cell-texts">
                      <p class="name">{{ order.customerFirstName }} {{ order.customerLastName }}</p>
                      <p class="sub">{{ order.customerEmail }}</p>
                    </div>
                  </div>
                </td>
                <td><span class="order-price">{{ formatPrice(order.totalAmount) }}</span></td>
                <td><app-badge [status]="getStatusBadge(order.orderStatus)" /></td>
                <td>
                  <div class="actions">
                    <span class="material-icons view"
                      (click)="$event.stopPropagation(); selectOrder(order)">visibility</span>
                    <span class="material-icons edit" (click)="$event.stopPropagation()">edit</span>
                  </div>
                </td>
              </tr>
              } @empty {
              <tr>
                <td colspan="6">
                  <div class="empty-state">
                    <span class="material-icons empty-icon">inbox</span>
                    @if (selectedStatus() !== '') {
                    <p class="empty-title">Nessun ordine con stato "{{ getSelectedStatusText() }}"</p>
                    <p class="empty-subtitle">Non ci sono ordini con questo stato. Prova un altro filtro.</p>
                    } @else {
                    <p class="empty-title">Nessun ordine trovato</p>
                    <p class="empty-subtitle">Non sono presenti ordini corrispondenti alla ricerca.</p>
                    }
                  </div>
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
      </div>

      <div id="order-detail-section">
        @if (showDetail) {
        <app-order-form [order]="selectedOrder()!" (statusUpdate)="updateStatus($event)" (cancel)="handleCancel()">
        </app-order-form>
        }
      </div>
    </div>
  </div>
</div>