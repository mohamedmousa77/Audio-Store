<app-client-header />

<main class="product-detail-page">

  <!-- Loading State -->
  @if (loading) {
  <div class="loading-state">
    <div class="spinner"></div>
  </div>
  }

  <!-- Product Content -->
  @if (product && !loading) {
  <div class="product-container">
    <div class="product-grid">
      <!-- Gallery Section -->
      <div class="product-gallery">
        <!-- Main Image -->
        <div class="main-image-container">
          <div class="main-image" [style.backgroundImage]="'url(' + currentImage + ')'"></div>

          <!-- Badge -->
          @if (product.isFeatured || product.isNew) {
          <div class="product-badges">
            @if (product.isFeatured) {
            <span class="badge badge-featured">{{ translations().product.bestSeller }}</span>
            }
            @if (product.isNew) {
            <span class="badge badge-new">{{ translations().product.new }}</span>
            }
          </div>
          }
        </div>

        <!-- Thumbnail Gallery - only show if multiple images -->
        @if (productImages.length > 1) {
        <div class="thumbnail-gallery">
          @for (img of productImages; track $index) {
          <button class="thumbnail" [class.active]="$index === selectedImageIndex" (click)="selectImage($index)"
            [style.backgroundImage]="'url(' + img + ')'"></button>
          }
        </div>
        }
      </div>

      <!-- Product Info Section -->
      <div class="product-info">
        <!-- Brand & Title -->
        <p class="product-brand">{{ product.brand }}</p>
        <h1 class="product-title">{{ product.name }}</h1>

        <!-- Rating & Reviews -->
        <!-- <div class="product-rating">
          <div class="stars">
            <span class="material-icons filled">star</span>
            <span class="material-icons filled">star</span>
            <span class="material-icons filled">star</span>
            <span class="material-icons filled">star</span>
            <span class="material-icons half">star_half</span>
          </div>
          <span class="review-count">(128 Reviews)</span>
        </div> -->

        <!-- Price -->
        <div class="product-price-section">
          <span class="current-price">${{ product.price.toFixed(2) }}</span>
          @if (product.price < 400) { <span class="original-price">
            ${{ (product.price * 1.15).toFixed(2) }}
            </span>
            <span class="discount">{{ translations().product.save }} 13%</span>
            }
        </div>

        <!-- Description -->
        <p class="product-description">
          {{ product.description || 'Premium quality audio equipment with exceptional sound performance.' }}
        </p>

        <!-- Stock Status -->
        <div class="stock-status" [class.in-stock]="product.stockQuantity > 0">
          <span class="material-icons">{{ product.stockQuantity > 0 ? 'check_circle' : 'cancel' }}</span>
          @if (product.stockQuantity > 0) {
          <span>{{ translations().productDetails.inStock }} - {{ translations().product.only }} {{ product.stockQuantity
            }} {{
            translations().product.piecesAvailable }}</span>
          } @else {
          <span>{{ translations().productDetails.outOfStock }}</span>
          }
        </div>

        <!-- Color Selection -->
        <!-- <div class="color-selection">
          <label>{{ translations().product.color }}:</label>
          <div class="color-options">
            <button class="color-btn" [class.active]="selectedColor === 'black'" (click)="selectedColor = 'black'"
              style="background: #000" title="Black"></button>
            <button class="color-btn" [class.active]="selectedColor === 'silver'" (click)="selectedColor = 'silver'"
              style="background: #c0c0c0" title="Silver"></button>
            <button class="color-btn" [class.active]="selectedColor === 'gold'" (click)="selectedColor = 'gold'"
              style="background: #ffd700" title="Gold"></button>
          </div>
        </div> -->

        <!-- Quantity & Actions -->
        <div class="quantity-actions">
          <div class="quantity-selector">
            <button (click)="decrementQuantity()" class="qty-btn">
              <span class="material-icons">remove</span>
            </button>
            <input type="number" [(ngModel)]="quantity" min="1" [max]="product.stockQuantity" class="qty-input" />
            <button (click)="incrementQuantity()" class="qty-btn">
              <span class="material-icons">add</span>
            </button>
          </div>

          <button class="add-to-cart-btn" (click)="addToCart()" [disabled]="product.stockQuantity === 0">
            <span class="material-icons">shopping_bag</span>
            {{ translations().productDetails.addToCart }}
          </button>
        </div>

        <!-- Features -->
        <!-- <div class="features-grid">
          <div class="feature">
            <span class="material-icons">battery_charging_full</span>
            <div>
              <p class="feature-label">{{ translations().product.battery }}</p>
              <p class="feature-value">50 Hours</p>
            </div>
          </div>
          <div class="feature">
            <span class="material-icons">bluetooth</span>
            <div>
              <p class="feature-label">{{ translations().product.wireless }}</p>
              <p class="feature-value">Bluetooth 5.0</p>
            </div>
          </div>
        </div> -->
      </div>
    </div>

    <!-- Details Tabs -->
    <div class="details-section">
      <div class="details-tabs">
        <button class="tab-btn active" (click)="scrollToSection('description')">{{
          translations().productDetails.description }}</button>
        @if (hasFeatures) {
        <button class="tab-btn" (click)="scrollToSection('specifications')">{{
          translations().productDetails.specifications }}</button>
        }
      </div>

      <div class="tab-content">
        <div id="description" class="description-tab">
          <h3>{{ translations().productDetails.productDescription }}</h3>
          <p>{{ product.description }}
          </p>
          @if (hasFeatures) {
          <div id="specifications">
            <h4>{{ translations().productDetails.keyFeatures }}:</h4>
            <p>{{ product.specs }}</p>
          </div>
          }
        </div>
      </div>
    </div>

    <!-- Related Products -->
    @if (relatedProducts.length > 0) {
    <section class="related-products">
      <h2 class="section-title">{{ translations().productDetails.youMayAlsoLike }}</h2>
      <div class="related-grid">
        @for (relatedProduct of relatedProducts; track relatedProduct.id) {
        <app-product-card [product]="relatedProduct" [clickable]="true"
          (productSelected)="onRelatedProductSelected($event)" />
        }
      </div>
    </section>
    }
  </div>
  }
</main>

<app-client-footer />