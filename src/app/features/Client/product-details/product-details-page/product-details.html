<app-client-header />

<main class="product-detail-page">

  <!-- Loading State -->
  @if (loading) {
  <div class="loading-state">
    <div class="spinner"></div>
  </div>
  }

  <!-- Product Content -->
  @if (product && !loading) {
  <div class="product-container">
    <div class="product-grid">
      <!-- Gallery Section -->
      <div class="product-gallery">
        <!-- Main Image -->
        <div class="main-image-container">
          <div class="main-image" [style.backgroundImage]="'url(' + currentImage + ')'"></div>

          <!-- Badge -->
          @if (product.isFeatured || product.isNew) {
          <div class="product-badges">
            @if (product.isFeatured) {
            <span class="badge badge-featured">BEST SELLER</span>
            }
            @if (product.isNew) {
            <span class="badge badge-new">NEW</span>
            }
          </div>
          }
        </div>

        <!-- Thumbnail Gallery -->
        <div class="thumbnail-gallery">
          @for (img of productImages; track $index) {
          <button class="thumbnail" [class.active]="$index === selectedImageIndex" (click)="selectImage($index)"
            [style.backgroundImage]="'url(' + img + ')'"></button>
          }
        </div>
      </div>

      <!-- Product Info Section -->
      <div class="product-info">
        <!-- Brand & Title -->
        <p class="product-brand">{{ product.brand }}</p>
        <h1 class="product-title">{{ product.name }}</h1>

        <!-- Rating & Reviews -->
        <div class="product-rating">
          <div class="stars">
            <span class="material-icons filled">star</span>
            <span class="material-icons filled">star</span>
            <span class="material-icons filled">star</span>
            <span class="material-icons filled">star</span>
            <span class="material-icons half">star_half</span>
          </div>
          <span class="review-count">(128 Reviews)</span>
        </div>

        <!-- Price -->
        <div class="product-price-section">
          <span class="current-price">${{ product.price.toFixed(2) }}</span>
          @if (product.price < 400) { <span class="original-price">
            ${{ (product.price * 1.15).toFixed(2) }}
            </span>
            <span class="discount">Save 13%</span>
            }
        </div>

        <!-- Description -->
        <p class="product-description">
          {{ product.description || 'Premium quality audio equipment with exceptional sound performance.' }}
        </p>

        <!-- Stock Status -->
        <div class="stock-status" [class.in-stock]="product.stock > 0">
          <span class="material-icons">{{ product.stock > 0 ? 'check_circle' : 'cancel' }}</span>
          @if (product.stock > 0) {
          <span>In Stock - Only {{ product.stock }} pieces available</span>
          } @else {
          <span>Out of Stock</span>
          }
        </div>

        <!-- Color Selection -->
        <div class="color-selection">
          <label>Color:</label>
          <div class="color-options">
            <button class="color-btn" [class.active]="selectedColor === 'black'" (click)="selectedColor = 'black'"
              style="background: #000" title="Black"></button>
            <button class="color-btn" [class.active]="selectedColor === 'silver'" (click)="selectedColor = 'silver'"
              style="background: #c0c0c0" title="Silver"></button>
            <button class="color-btn" [class.active]="selectedColor === 'gold'" (click)="selectedColor = 'gold'"
              style="background: #ffd700" title="Gold"></button>
          </div>
        </div>

        <!-- Quantity & Actions -->
        <div class="quantity-actions">
          <div class="quantity-selector">
            <button (click)="decrementQuantity()" class="qty-btn">
              <span class="material-icons">remove</span>
            </button>
            <input type="number" [(ngModel)]="quantity" min="1" [max]="product.stock" class="qty-input" />
            <button (click)="incrementQuantity()" class="qty-btn">
              <span class="material-icons">add</span>
            </button>
          </div>

          <button class="add-to-cart-btn" (click)="addToCart()" [disabled]="product.stock === 0">
            <span class="material-icons">shopping_bag</span>
            Add to Cart
          </button>
        </div>

        <!-- Features -->
        <div class="features-grid">
          <div class="feature">
            <span class="material-icons">battery_charging_full</span>
            <div>
              <p class="feature-label">Battery</p>
              <p class="feature-value">50 Hours</p>
            </div>
          </div>
          <div class="feature">
            <span class="material-icons">bluetooth</span>
            <div>
              <p class="feature-label">Wireless</p>
              <p class="feature-value">Bluetooth 5.0</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Details Tabs -->
    <div class="details-section">
      <div class="details-tabs">
        <button class="tab-btn active">Description</button>
        <button class="tab-btn">Specifications</button>
        <button class="tab-btn">Reviews</button>
      </div>

      <div class="tab-content">
        <div class="description-tab">
          <h3>Product Description</h3>
          <p>
            The {{ product.name }} is a premium audio device designed for discerning audiophiles
            and music professionals. With cutting-edge technology and superior sound quality, it delivers
            an unparalleled listening experience.
          </p>
          <h4>Key Features:</h4>
          <ul>
            <li>Advanced noise cancellation technology</li>
            <li>High-fidelity audio drivers</li>
            <li>Extended battery life</li>
            <li>Premium materials and construction</li>
            <li>Wireless connectivity</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Related Products -->
    @if (relatedProducts.length > 0) {
    <section class="related-products">
      <h2 class="section-title">You May Also Like</h2>
      <div class="related-grid">
        @for (relatedProduct of relatedProducts; track relatedProduct.id) {
        <app-product-card [product]="relatedProduct" [clickable]="true"
          (productSelected)="onRelatedProductSelected($event)" />
        }
      </div>
    </section>
    }
  </div>
  }
</main>

<app-client-footer />