<app-client-header></app-client-header>

<main class="confirmation-bg">
  <div class="container-premium">

    <!-- LOADING STATE -->
    @if (loading()) {
    <div class="state-card">
      <div class="loader-circle"></div>
      <p>Stiamo caricando i dettagli del tuo acquisto...</p>
    </div>
    }

    <!-- ERROR STATE -->
    @if (!loading() && error()) {
    <div class="state-card">
      <span class="material-symbols-outlined error-icon">sentiment_very_dissatisfied</span>
      <h2>Oops! Ordine non trovato</h2>
      <p>Non siamo riusciti a trovare l'ordine <strong>{{ orderNumber() }}</strong>.</p>
      <button class="btn-primary-custom" (click)="continueShopping()">Torna allo Shop</button>
    </div>
    }

    <!-- SUCCESS STATE -->
    @if (!loading() && !error() && order()) {
    <div class="confirmation-layout">

      <!-- HERO SECTION - Success Message -->
      <section class="hero-success-card">
        <div class="check-wrapper">
          <span class="material-symbols-outlined">check_circle</span>
        </div>
        <h1>Thank you for your order!</h1>
        <p class="hero-text">
          We've sent a confirmation email to
          <strong>{{ order()!.customerEmail }}</strong>. Your order
          <strong>#{{ order()!.orderNumber }}</strong> has been placed successfully.
        </p>
        <div class="hero-buttons">
          <button class="btn-orange-filled" (click)="continueShopping()">
            Return to Shopping
          </button>
          <button class="btn-white-outline" (click)="downloadInvoice()">
            Download Invoice
          </button>
        </div>
      </section>

      <!-- MAIN GRID LAYOUT -->
      <div class="order-grid">

        <!-- LEFT COLUMN - Items and Details -->
        <div class="left-col">

          <!-- ITEMS ORDERED SECTION -->
          <section class="premium-card">
            <div class="card-header">
              <h3>Items Ordered</h3>
              <span class="count-pill">{{ order()!.items.length }} Items</span>
            </div>
            <div class="items-container">
              @for (item of order()!.items; track item.id) {
              <div class="product-row">
                <img [src]="item.productImage" [alt]="item.productName" class="product-image" />
                <div class="product-info">
                  <p class="p-name">{{ item.productName }}</p>
                  <p class="p-qty">Qty: {{ item.quantity }}</p>
                </div>
                <div class="product-price">
                  €{{ item.subtotal.toFixed(2) }}
                </div>
              </div>
              }
            </div>
          </section>

          <!-- SHIPPING & PAYMENT ROW -->
          <div class="address-payment-row">

            <!-- SHIPPING ADDRESS -->
            <section class="premium-card">
              <h4 class="card-title">
                <span class="material-symbols-outlined">local_shipping</span>
                Shipping Address
              </h4>
              <div class="address-box">
                <p>
                  <strong>
                    {{ order()!.customerFirstName }}
                    {{ order()!.customerLastName }}
                  </strong>
                </p>
                <p>{{ order()!.shippingStreet }}</p>
                <p>
                  {{ order()!.shippingPostalCode }}
                  {{ order()!.shippingCity }}
                </p>
                <p>{{ order()!.shippingCountry }}</p>
              </div>
            </section>

            <!-- PAYMENT METHOD -->
            <section class="premium-card">
              <h4 class="card-title">
                <span class="material-symbols-outlined">payments</span>
                Payment Method
              </h4>
              <div class="payment-box">
                <p>{{ order()!.paymentMethod || 'Cash on Delivery' }}</p>
                <span class="badge-payment">Pay upon receipt</span>
              </div>
            </section>
          </div>
        </div>

        <!-- RIGHT COLUMN - Order Summary Sidebar -->
        <aside class="right-col">
          <div class="summary-premium-card">
            <h3>Order Summary</h3>

            <div class="summary-lines">
              <div class="s-line">
                <span>Subtotal</span>
                <span>€{{ order()!.subtotal.toFixed(2) }}</span>
              </div>
              <div class="s-line">
                <span>Shipping</span>
                <span class="text-green">€{{ order()!.shippingCost.toFixed(2) }}</span>
              </div>
              <div class="s-line">
                <span>Tax Est.</span>
                <span>€{{ order()!.tax.toFixed(2) }}</span>
              </div>
            </div>

            <div class="s-divider"></div>

            <!-- TOTAL -->
            <div class="s-total">
              <div class="total-label-group">
                <span class="total-title">Total</span>
                <span class="total-note">Includes all taxes and duties</span>
              </div>
              <span class="total-price-val">€{{ order()!.totalAmount.toFixed(2) }}</span>
            </div>

            <!-- ORDER STATUS -->
            <div class="estimate-box">
              <span class="material-symbols-outlined">info</span>
              <div class="estimate-text">
                <p>Order Status</p>
                <strong>{{ getStatusText(order()!.orderStatus) }}</strong>
              </div>
            </div>
          </div>
        </aside>
      </div>
    </div>
    }
  </div>
</main>

<app-client-footer></app-client-footer>