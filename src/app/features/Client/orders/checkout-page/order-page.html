<app-client-header />
<div class="checkout-container">
  <header class="checkout-header">
    <h1>{{ translations().checkout.title }}</h1>
    @if (!isAuthenticated()) {
    <p class="login-prompt">{{ translations().auth.haveAccount }} <a href="auth/login">{{ translations().auth.login
        }}.</a></p>
    }
  </header>
  <!-- Error Message -->
  @if (errorMessage()) {
  <div class="error-banner">
    <span class="error-icon">⚠️</span>
    <span class="error-text">{{ errorMessage() }}</span>
  </div>
  }

  <div class="checkout-content">
    <div class="checkout-forms-area">

      <section class="form-section">
        <div class="section-header">
          <span class="step-badge">1</span>
          <h2>{{ translations().checkout.shippingAddress }}</h2>
        </div>

        <form [formGroup]="shippingForm" class="form-grid">
          <div class="form-group">
            <label>{{ translations().checkout.firstName }}</label>
            <input type="text" formControlName="firstName" placeholder="e.g. Alex">
            @if (shippingForm.get('firstName')?.invalid && shippingForm.get('firstName')?.touched) {
            <span class="error-message">{{ translations().checkout.errors.firstNameRequired }}</span> 
            }
          </div>
          <div class="form-group">
            <label>{{ translations().checkout.lastName }}</label>
            <input type="text" formControlName="lastName" placeholder="e.g. Doe">
            @if (shippingForm.get('lastName')?.invalid && shippingForm.get('lastName')?.touched) {
            <span class="error-message">
              {{ translations().checkout.errors.lastNameRequired }}
            </span>
            }
          </div>
          <div class="form-group full-width">
            <label>{{ translations().checkout.email }}</label>
            <input type="email" formControlName="email" placeholder="alex@example.com">
            @if (shippingForm.get('email')?.invalid && shippingForm.get('email')?.touched) {
            <span class="error-message">
              {{ translations().checkout.errors.emailRequired }}
            </span>
            }
          </div>
          <div class="form-group full-width">
            <label>{{ translations().checkout.phone }}</label>
            <input type="tel" formControlName="phone" placeholder="+1 (555) 000-0000">
            @if (shippingForm.get('phone')?.invalid && shippingForm.get('phone')?.touched) {
            <span class="error-message">
             {{ translations().checkout.errors.phoneRequired }}
            </span>
            }
          </div>
          <div class="form-group full-width">
            <label>{{ translations().checkout.address }}</label>
            <input type="text" formControlName="address" placeholder="123 Audio Lane, Apt 4B">
            @if (shippingForm.get('address')?.invalid && shippingForm.get('address')?.touched) {
            <span class="error-message">
              {{ translations().checkout.errors.addressRequired }}
            </span>
            }
          </div>
          <div class="form-group">
            <label>{{ translations().checkout.zipCode }}</label>
            <input type="text" formControlName="zipCode" placeholder="10001">
            @if (shippingForm.get('zipCode')?.invalid && shippingForm.get('zipCode')?.touched) {
            <span class="error-message">
              {{ translations().checkout.errors.zipCodeRequired }}
            </span>
            }
          </div>
          <div class="form-group">
            <label>{{ translations().checkout.city }}</label>
            <input type="text" formControlName="city" placeholder="New York">
            @if (shippingForm.get('city')?.invalid && shippingForm.get('city')?.touched) {
            <span class="error-message">
             {{ translations().checkout.errors.cityRequired }}
            </span>
            }
          </div>
          <div class="form-group full-width">
            <label>{{ translations().checkout.country }}</label>
            <select formControlName="country">
              <option value="United States">United States</option>
              <option value="Italy">Italy</option>
            </select>
          </div>
        </form>
      </section>
      <!-- Payment Section -->
      <section class="form-section">
        <div class="section-header Payment-Method">
          <span class="step-badge">2</span>
          <h2>{{ translations().checkout.paymentMethod }}</h2>
        </div>

        <div class="payment-card-selector selected">
          <div class="payment-info">
            <div class="payment-icon">
              <span class="material-symbols-outlined">payments</span>
            </div>
            <div class="payment-text">
              <h3>{{ translations().checkout.defaultPaymentMethod }}</h3>
              <p>{{ translations().checkout.paymentMessage }}</p>
            </div>
          </div>
          <span class="status-badge">{{ translations().checkout.selected }}</span>
        </div>
      </section>
    </div>

    <aside class="order-summary-card">
      <h3>{{ translations().checkout.orderSummary }}</h3>

      <div class="summary-product-list">
        @for (item of items(); track item.id) {
        <div class="summary-product-item">
          <img [src]="item.productImage" [alt]="item.productImage" class="mini-thumb">
          <div class="mini-details">
            <p class="mini-name">{{ item.productName }}</p>
            <p class="mini-meta">{{ translations().cart.quantity }}: {{ item.quantity }}</p>
          </div>
          <span class="mini-price">€{{ (item.unitPrice * item.quantity).toFixed(2) }}</span>
        </div>
        }
      </div>

      <div class="summary-divider"></div>

      <div class="cost-breakdown">
        <div class="cost-row">
          <span>{{ translations().cart.subtotal }}</span>
          <span class="cost-val">€{{ totalPrice().toFixed(2) }}</span>
        </div>
        <div class="cost-row">
          <span>{{ translations().checkout.shipping }}</span>
          <span class="cost-val text-green">{{ translations().checkout.free }}</span>
        </div>
        <div class="cost-row">
          <span>VAT (10%)</span>
          <span class="cost-val">€{{ getTaxAmount().toFixed(2) }}</span>
        </div>
      </div>

      <div class="total-section">
        <div class="total-row">
          <span class="total-label">{{ translations().checkout.orderTotal }}</span>
          <div class="total-amount-group">
            <span class="total-price">€{{ getTotalAmount().toFixed(2) }}</span>
            <span class="tax-note">{{ translations().checkout.includesTaxes }}</span>
          </div>
        </div>

        <button class="btn-confirm-order" (click)="placeOrder()" [disabled]="isProcessing()">
          @if (isProcessing()) {
          {{ translations().common.loading }}
          } @else {
          {{ translations().checkout.confirmOrder }}
          <span class="material-symbols-outlined">arrow_forward</span>
          }
        </button>
      </div>

      <div class="trust-footer">
        <div class="trust-item"><span class="material-symbols-outlined">shield_with_heart</span> {{
          translations().checkout.secure }}</div>
        <div class="trust-item"><span class="material-symbols-outlined">package_2</span> {{
          translations().checkout.insured }}</div>
        <div class="trust-item"><span class="material-symbols-outlined">support_agent</span> {{
          translations().checkout.support }}</div>
      </div>
    </aside>
  </div>
</div>