<app-client-header />
<div class="checkout-container">
  <header class="checkout-header">
    <h1>Checkout</h1>
    <p class="login-prompt">Already have an account? <a href="#">Log in to pre-fill your details.</a></p>
  </header>
  <!-- Error Message -->
  @if (errorMessage()) {
  <div class="error-banner">
    <span class="error-icon">⚠️</span>
    <span class="error-text">{{ errorMessage() }}</span>
  </div>
  }

  <div class="checkout-content">
    <div class="checkout-forms-area">

      <section class="form-section">
        <div class="section-header">
          <span class="step-badge">1</span>
          <h2>Shipping Details</h2>
        </div>

        <form [formGroup]="shippingForm" class="form-grid">
          <div class="form-group">
            <label>First Name</label>
            <input type="text" formControlName="firstName" placeholder="e.g. Alex">
            @if (shippingForm.get('firstName')?.invalid && shippingForm.get('firstName')?.touched) {
            <span class="error">
              The first name is required and must have at least 2 characters.
            </span>
            }
          </div>
          <div class="form-group">
            <label>Last Name</label>
            <input type="text" formControlName="lastName" placeholder="e.g. Doe">
            @if (shippingForm.get('lastName')?.invalid && shippingForm.get('lastName')?.touched) {
            <span class="error">
              The last name is required and must have at least 2 characters.
            </span>
            }
          </div>
          <div class="form-group full-width">
            <label>Email Address</label>
            <input type="email" formControlName="email" placeholder="alex@example.com">
            @if (shippingForm.get('email')?.invalid && shippingForm.get('email')?.touched) {
            <span class="error">
              A valid email address is required.
            </span>
            }
          </div>
          <div class="form-group full-width">
            <label>Phone Number</label>
            <input type="tel" formControlName="phone" placeholder="+1 (555) 000-0000">
            @if (shippingForm.get('phone')?.invalid && shippingForm.get('phone')?.touched) {
            <span class="error">
              A valid phone number is required.
            </span>
            }
          </div>
          <div class="form-group full-width">
            <label>Street Address</label>
            <input type="text" formControlName="address" placeholder="123 Audio Lane, Apt 4B">
            @if (shippingForm.get('address')?.invalid && shippingForm.get('address')?.touched) {
            <span class="error">
              The address is required and must have at least 5 characters.
            </span>
            }
          </div>
          <div class="form-group">
            <label>ZIP / Postal Code</label>
            <input type="text" formControlName="zipCode" placeholder="10001">
            @if (shippingForm.get('zipCode')?.invalid && shippingForm.get('zipCode')?.touched) {
            <span class="error">
              The postal code is required and must have 5 digits.
            </span>
            }
          </div>
          <div class="form-group">
            <label>City</label>
            <input type="text" formControlName="city" placeholder="New York">
            @if (shippingForm.get('city')?.invalid && shippingForm.get('city')?.touched) {
            <span class="error">
              The city is required.
            </span>
            }
          </div>
          <div class="form-group full-width">
            <label>Country</label>
            <select formControlName="country">
              <option value="United States">United States</option>
              <option value="Italy">Italy</option>
            </select>
          </div>
        </form>
      </section>
      <!-- Payment Section -->
      <section class="form-section">
        <div class="section-header Payment-Method">
          <span class="step-badge">2</span>
          <h2>Payment Method</h2>
        </div>

        <div class="payment-card-selector selected">
          <div class="payment-info">
            <div class="payment-icon">
              <span class="material-symbols-outlined">payments</span>
            </div>
            <div class="payment-text">
              <h3>Cash on Delivery</h3>
              <p>Pay securely when your order arrives at your doorstep.</p>
            </div>
          </div>
          <span class="status-badge">SELECTED</span>
        </div>
      </section>
    </div>

    <aside class="order-summary-card">
      <h3>Order Summary</h3>

      <div class="summary-product-list">
        @for (item of items(); track item.id) {
        <div class="summary-product-item">
          <img [src]="item.image" [alt]="item.name" class="mini-thumb">
          <div class="mini-details">
            <p class="mini-name">{{ item.name }}</p>
            <p class="mini-meta">Qty: {{ item.quantity }}</p>
          </div>
          <span class="mini-price">€{{ (item.price * item.quantity).toFixed(2) }}</span>
        </div>
        }
      </div>

      <div class="summary-divider"></div>

      <div class="cost-breakdown">
        <div class="cost-row">
          <span>Subtotal</span>
          <span class="cost-val">€{{ totalPrice().toFixed(2) }}</span>
        </div>
        <div class="cost-row">
          <span>Shipping</span>
          <span class="cost-val text-green">Free</span>
        </div>
        <div class="cost-row">
          <span>VAT (10%)</span>
          <span class="cost-val">€{{ getTaxAmount().toFixed(2) }}</span>
        </div>
      </div>

      <div class="total-section">
        <div class="total-row">
          <span class="total-label">Order Total</span>
          <div class="total-amount-group">
            <span class="total-price">€{{ getTotalAmount().toFixed(2) }}</span>
            <span class="tax-note">Includes all taxes</span>
          </div>
        </div>

        <button class="btn-confirm-order" (click)="placeOrder()" [disabled]="isProcessing()">
          @if (isProcessing()) {
          Processing...
          } @else {
          Confirm Order
          <span class="material-symbols-outlined">arrow_forward</span>
          }
        </button>
      </div>

      <div class="trust-footer">
        <div class="trust-item"><span class="material-symbols-outlined">shield_with_heart</span> Secure</div>
        <div class="trust-item"><span class="material-symbols-outlined">package_2</span> Insured</div>
        <div class="trust-item"><span class="material-symbols-outlined">support_agent</span> 24/7 Help</div>
      </div>
    </aside>
  </div>
</div>